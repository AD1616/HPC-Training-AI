{% include 'includes/_navbar.html' %}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="../../../../favicon.ico">

    <title>HPC Training AI</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href= "{{ url_for('static',filename='styles/input.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</head>

<body>
    {% include 'includes/_navbar.html' %}

    <div class="form__group field">
      <input type="input" class="form__field" placeholder="What are some resources for..." name="query" id='query' autocomplete="off" />
      <label for="query" class="form__label">Chat</label>
    </div>

    <br>
    <br>

    <p id = "loading"> </p>
    <br>
    <p id = "output"> </p>

    <script>
        var input = document.getElementById('query');
        var loading = document.getElementById('loading');

        var fetching = false;

        input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                const url = `/output?query=${encodeURIComponent(input.value)}`;
                loading.innerText = "finding sources...";
                console.log(loading.innerText);
                
                if (!fetching) {
                    fetching = true;
                    fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        loading.innerText = "";
                        document.getElementById('output').innerText = data;
                    })
                    .catch(error => console.error('Error:', error));
                }

                fetching = false
            }
        });
    </script>

</body>

